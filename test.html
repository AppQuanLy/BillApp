<!DOCTYPE html>
<html lang="vi">
<head>
    <title>Kiểm tra Thư viện Winwheel</title>
</head>
<body>
    <h1>Trang kiểm tra</h1>
    <p>Vui lòng xem thông báo (alert) hiện ra trên màn hình.</p>

    <script>
        let Winwheel=function(t,e){let r=null,a=null,n=null,i=null,o=null;function l(t){t||(t=window.event);t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}this.canvas=null,this.canvasId=null,this.centerX=0,this.centerY=0,this.outerRadius=0,this.innerRadius=0,this.numSegments=0,this.drawMode=null,this.rotationAngle=0,this.textFontFamily=null,this.textFontSize=0,this.textFontWeight=null,this.textOrientation=null,this.textAlignment=null,this.textDirection=null,this.textMargin=null,this.textFillStyle=null,this.textStrokeStyle=null,this.textLineWidth=null,this.fillStyle=null,this.strokeStyle=null,this.lineWidth=null,this.clearTheCanvas=null,this.imageOverlay=null,this.drawText=null,this.pointerAngle=null,this.wheelImage=null,this.imageDirection=null,this.responsive=!1,this.scaleFactor=1,this.segments=new Array(null),this.animation=null,this.pins=null,this.pointerGuide=null,this.tween=null,this.tweenSound=null,this.drawn= !1,this.id= "winwheel_"+(new Date).getTime();for(let e in t)this[e]instanceof Object&&null!=this[e]?(this[e]=new this[e].constructor,Object.assign(this[e],t[e])):this[e]=t[e];"string"==typeof t.canvasId?(this.canvasId=t.canvasId,this.canvas=document.getElementById(this.canvasId),this.canvas||(this.canvas=null)):this.canvas=t.canvasId,this.canvas?(this.centerX||(this.centerX=this.canvas.width/2),this.centerY||(this.centerY=this.canvas.height/2),this.numSegments||(this.numSegments=1),this.fillStyle||(this.fillStyle="silver"),this.lineWidth||(this.lineWidth=1),this.textFillStyle||(this.textFillStyle="black"),this.clearTheCanvas|| (this.clearTheCanvas= !0),this.drawText||(this.drawText= !0),this.textMargin||(0!=this.textMargin&&(this.textMargin=this.textFontSize/10)),this.animation||(this.animation=new Animation),this.pins||(this.pins=new Pins),this.pointerGuide||(this.pointerGuide=new PointerGuide),this.fillStyle instanceof Array||(this.fillStyle=[this.fillStyle]),this.strokeStyle instanceof Array||(this.strokeStyle=[this.strokeStyle]),this.lineWidth instanceof Array||(this.lineWidth=[this.lineWidth]),this.segments=new Array(null),this.textOrientation|| (this.textOrientation="horizontal"),this.textAlignment||(this.textAlignment="center"),this.textDirection||(this.textDirection="normal"),this.textMargin||(this.textMargin=0),this.textFontSize||(this.textFontSize=12),this.textFontFamily||(this.textFontFamily="Arial"),this.textFontWeight||(this.textFontWeight="normal"),this.pointerAngle||(this.pointerAngle=0),this.wheelImage&&(this.wheelImage instanceof HTMLImageElement?this.wheelImage.id=this.id+"_wheelImage":this.wheelImage instanceof String? (tmpImage=new Image,tmpImage.src=this.wheelImage,this.wheelImage=tmpImage,this.wheelImage.id=this.id+"_wheelImage"):this.wheelImage= null),this.imageDirection||(this.imageDirection="N")):this.canvasId=this.canvas=null;this.responsive&&(this.scaleFactor=.2,window.addEventListener("resize",(()=>this.draw(!1))),this.canvas.addEventListener("orientationchange",(()=>this.draw(!1))));for(let t=1;t<=this.numSegments;t++)this.segments[t]instanceof Object?this.segments[t].id="segmentNumber"+t:(this.segments[t]={id:"segmentNumber"+t},Object.assign(this.segments[t],e));this.updateAnimation(),this.checkPins(),this.draw(!0)},Winwheel.prototype.updateAnimation=function(){this.animation.wheel=this},Winwheel.prototype.checkPins=function(){this.pins.wheel=this},Winwheel.prototype.addSegment=function(t,e){if(this.numSegments++,this.segments.push(t),"undefined"!=typeof e){var r=this.getSegment(this.numSegments);r.id=e}this.draw()},Winwheel.prototype.setCanvasId=function(t){this.canvasId=t,this.canvas=document.getElementById(this.canvasId),this.draw()},Winwheel.prototype.deleteSegment= function(t){if(this.numSegments>1){if("undefined"!=typeof t)for(var e=1;e<this.numSegments;e++)this.segments[e].id==t&&(this.segments.splice(e,1),this.numSegments--,e--);else this.segments.pop(),this.numSegments--;this.draw()}else this.numSegments=0,this.segments=[]},Winwheel.prototype.getSegment=function(t){return this.segments[t-1]},Winwheel.prototype.getSegmentById=function(t){for(var e,r=1;r<this.segments.length;r++)t==this.segments[r].id&&(e=this.segments[r]);return e},Winwheel.prototype.getIndicatedSegment= function(){var t=this.getIndicatedSegmentNumber(),e=this.segments[t];return e.id&&"undefined"!=e.id?this.getSegmentById(e.id):this.segments[t]},Winwheel.prototype.getIndicatedSegmentNumber=function(){var t=0,e=this.getAngle(this.pointerAngle),r=Math.ceil(e/(360/this.numSegments));return r<1||r>this.numSegments?t=this.numSegments:t=r,t},Winwheel.prototype.getAngle=function(t){var e=this.rotationAngle;return t>e?e=360-(t-e):e=t-e,e},Winwheel.prototype.startAnimation=function(t){this.animation&& (this.tween&&this.tween.kill(),this.animation.start(),this.tween=TweenMax.to(this,this.animation.duration,{rotationAngle:this.animation.finalAngle,onUpdate:winwheelAnimationLoop,onComplete:winwheelStopAnimation,ease:this.animation.easing,yoyo:this.animation.yoyo}))},Winwheel.prototype.stopAnimation=function(t){this.tween&&this.tween.kill();var e=this.animation.callbackFinished;this.animation=new Animation,this.updateAnimation(),this.animation.callbackFinished=e,this.draw("undefined"!=typeof t&&t)},Winwheel.prototype.pauseAnimation=function(){this.tween.pause()},Winwheel.prototype.resumeAnimation=function(){this.tween.resume()},Winwheel.prototype.setCenter=function(t,e){this.centerX=t,this.centerY=e,this.draw()},Winwheel.prototype.draw=function(t){var n;t?"undefined"==typeof t&&(t=!0):t=!1,this.canvas&& (t&&this.clearTheCanvas&& (o=this.canvas.getContext("2d"),o.clearRect(0,0,this.canvas.width,this.canvas.height)),this.responsive&&(this.scaleFactor=this.canvas.parentElement.offsetWidth/this.canvas.width,this.canvas.height=this.canvas.parentElement.offsetHeight,this.canvas.style.transform="scale("+this.scaleFactor+")"),this.drawMode?this.wheelImage&&"image"==this.drawMode.toLowerCase()?this.drawWheelImage():this.drawSegmentImages():this.drawSegments(),this.imageOverlay&& (n=this.canvas.getContext("2d"),this.imageOverlay.id=this.id+"_overlayImage",n.drawImage(this.imageOverlay,0,0,this.canvas.width,this.canvas.height)),this.drawText&&this.drawSegmentText(),this.pointerGuide&&this.pointerGuide.draw(this.canvas),this.pins&&this.pins.draw(this.canvas)),this.drawn=!0},Winwheel.prototype.drawSegments=function(){var t=this.canvas.getContext("2d");if(this.segments){var e=1,n=360/this.numSegments;if(this.numSegments>1)for(var i=1;i<=this.numSegments;i++){"undefined"!=typeof this.segments[i].fillStyle?t.fillStyle=this.segments[i].fillStyle:t.fillStyle=this.fillStyle[e-1],"undefined"!=typeof this.segments[i].strokeStyle?t.strokeStyle=this.segments[i].strokeStyle:t.strokeStyle=this.strokeStyle[e-1],"undefined"!=typeof this.segments[i].lineWidth?t.lineWidth=this.segments[i].lineWidth:t.lineWidth=this.lineWidth[e-1],t.lineWidth||(t.lineWidth=0);var o=this.rotationAngle;this.segments[i].size&&(n=this.segments[i].size);var l=(i-1)*n+o;this.drawSegment(l,l+n,t),e++,this.fillStyle.length<e&&(e=1)}else if(1==this.numSegments){t.fillStyle=this.fillStyle[0],t.strokeStyle=this.strokeStyle[0]||this.fillStyle[0],t.lineWidth=this.lineWidth[0]||0;var s=1*this.rotationAngle;this.drawSegment(s,s+360,t)}t.lineWidth=this.lineWidth}},Winwheel.prototype.drawSegment= function(t,e,r){if(r.beginPath(),r.moveTo(this.centerX,this.centerY),this.innerRadius>0?r.arc(this.centerX,this.centerY,this.outerRadius,this.degToRad(t),this.degToRad(e),!1):r.lineTo(this.centerX+this.outerRadius*Math.cos(this.degToRad(t)),this.centerY+this.outerRadius*Math.sin(this.degToRad(t))),r.lineTo(this.centerX,this.centerY),this.innerRadius>0&&(r.moveTo(this.centerX,this.centerY),r.arc(this.centerX,this.centerY,this.innerRadius,this.degToRad(t),this.degToRad(e),!1)),r.closePath(),this.fillStyle&&(r.fill(),this.strokeStyle|| this.lineWidth>0)&&r.stroke()),r.lineWidth=this.lineWidth},Winwheel.prototype.drawSegmentImages=function(){o=this.canvas.getContext("2d");var t=1;if(360/this.numSegments,this.segments)for(var e=1;e<=this.numSegments;e++){var n,l=this.segments[e].image;if(o.save(),o.beginPath(),o.moveTo(this.centerX,this.centerY),this.innerRadius>0?o.arc(this.centerX,this.centerY,this.outerRadius,this.degToRad((e-1)*(360/this.numSegments)+this.rotationAngle),this.degToRad(e*(360/this.numSegments)+this.rotationAngle),!1):o.lineTo(this.centerX+this.outerRadius*Math.cos(this.degToRad(e*(360/this.numSegments)+this.rotationAngle)),this.centerY+this.outerRadius*Math.sin(this.degToRad(e*(360/this.numSegments)+this.rotationAngle))),o.lineTo(this.centerX,this.centerY),o.closePath(),o.clip(),o.save(),o.translate(this.centerX,this.centerY),o.rotate(this.degToRad(e*(360/this.numSegments)+this.rotationAngle+360/this.numSegments/2)),o.translate(-this.centerX,-this.centerY),o.drawImage(l,this.centerX-l.width/2,this.centerY-this.innerRadius-l.height),o.restore(),o.restore(),t++,this.fillStyle.length<t&&(t=1))}},Winwheel.prototype.drawWheelImage= function(){if(this.wheelImage){o=this.canvas.getContext("2d");var t=this.centerX-this.wheelImage.height/2,e=this.centerY-this.wheelImage.width/2;o.save(),o.translate(this.centerX,this.centerY);var n;"N"==this.imageDirection?n=this.rotationAngle:n=this.rotationAngle-90,o.rotate(this.degToRad(n)),o.translate(-this.centerX,-this.centerY),o.drawImage(this.wheelImage,t,e),o.restore()}},Winwheel.prototype.drawSegmentText=function(){if(this.segments)for(var t=1;t<=this.numSegments;t++){if(this.segments[t].text){var e=this.canvas.getContext("2d");e.save(),e.textAlign=this.textAlignment,e.textBaseline="middle",e.font=this.textFontWeight+" "+this.textFontSize+"px "+this.textFontFamily;var a=this.computeSegmentAngles(t,this.rotationAngle),n=a.end-a.start;if("curved"==this.textOrientation)this.drawCurvedText(e,this.segments[t],a.start,n);else{if("reversed"==this.textDirection){var i=a.start+(n/180*Math.PI/2*90);i+=Math.PI}else i=a.start+n/2;e.translate(this.centerX,this.centerY),e.rotate(this.degToRad(i)),e.translate(-this.centerX,-this.centerY);var o=0;o="inner"==this.textAlignment?this.innerRadius+this.textMargin+this.textFontSize/2.2:"outer"==this.textAlignment?this.outerRadius-this.textMargin:"center"==this.textAlignment&&(this.innerRadius+this.outerRadius)/2;var l=this.segments[t].textFillStyle?this.segments[t].textFillStyle:this.textFillStyle;l&&(e.fillStyle=l);var s=this.segments[t].textStrokeStyle?this.segments[t].textStrokeStyle:this.textStrokeStyle,h=this.segments[t].textLineWidth?this.segments[t].textLineWidth:this.textLineWidth;s&&h&&(e.strokeStyle=s,e.lineWidth=h),e.fillText(this.segments[t].text,this.centerX,o),s&&h&&e.strokeText(this.segments[t].text,this.centerX,o)}e.restore()}}},Winwheel.prototype.computeSegmentAngles=function(t,e){var r=0,a=0,n=this.getAngle(this.pointerAngle);this.segments[t].size?a=this.segments[t].size:a=360/this.numSegments;for(var i=1;i<t;i++)this.segments[i].size?r+=this.segments[i].size:r+=360/this.numSegments;var o=r+e;return{start:o,end:o+a}},Winwheel.prototype.degToRad=function(t){return t*(Math.PI/180)},Winwheel.prototype.drawCurvedText= function(t,e,r,a){var n=this.textDirection;if(e.textDirection)n=e.textDirection;for(var i=0,o=0,l=0,s=0;s<e.text.length;s++)i+=t.measureText(e.text[s]).width;o=this.innerRadius,l="inner"==this.textAlignment?o+this.textMargin:"outer"==this.textAlignment?this.outerRadius-this.textMargin:"center"==this.textAlignment&&(o+this.outerRadius)/2;var h,c=i/e.text.length,u=l*Math.PI/180,d=360/u,g=c*e.text.length/d;h="reversed"==n?r+a/2+g/2:r+a/2-g/2;for(var m=0;m<e.text.length;m++){t.save();var p=e.text[m],f=t.measureText(p).width,y=f/d,v=h;h="reversed"==n?h-y:h+y,t.translate(this.centerX,this.centerY),t.rotate(this.degToRad(v)),t.translate(-this.centerX,-this.centerY),t.fillText(p,this.centerX,l),t.restore()}}},Animation.prototype.start=function(){this.finalAngle=this.wheel.rotationAngle+this.spins*(this.getRandomInt(355,365))+this.stopAngle-this.wheel.rotationAngle%360},Animation.prototype.getRandomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},Pins.prototype.draw= function(t){if(t){var e=t.getContext("2d");if(this.wheel.pins&&this.wheel.pins.number){for(var n=this.wheel.centerX,i=this.wheel.centerY,o=this.wheel.outerRadius-5,l=this.wheel.pins.number,s=360/l,h=this.wheel.rotationAngle,c=1;c<=l;c++){e.beginPath();var u=this.wheel.degToRad(c*s+h),d=n+o*Math.cos(u),g=i+o*Math.sin(u);e.moveTo(n,i),e.arc(d,g,this.wheel.pins.outerRadius,0,2*Math.PI),this.wheel.pins.fillStyle&&(e.fillStyle=this.wheel.pins.fillStyle),this.wheel.pins.strokeStyle&&(e.strokeStyle=this.wheel.pins.strokeStyle),e.fill(),e.stroke()}}}},PointerGuide.prototype.draw= function(t){if(t){var e=t.getContext("2d");e.save(),e.translate(this.wheel.centerX,this.centerY),e.rotate(this.wheel.degToRad(this.wheel.pointerAngle)),e.translate(-this.wheel.centerX,-this.centerY),e.beginPath(),e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.moveTo(this.wheel.centerX,this.centerY),e.lineTo(this.wheel.centerX,0),e.stroke(),e.restore()}};var Animation=function(t){this.wheel=null,this.type="spinToStop",this.duration=5,this.spins=8,this.finalAngle=null,this.stopAngle=null,this.yoyo=!1,this.easing="Power3.easeOut",this.callbackFinished=null,this.callbackSound=null,this.soundTrigger="pin";for(var e in t)this[e]=t[e]},Pins=function(t){this.wheel=null,this.visible=!0,this.number=36,this.outerRadius=3,this.fillStyle="grey",this.strokeStyle="black";for(var e in t)this[e]=t[e]},PointerGuide=function(t){this.wheel=null,this.visible=!0,this.strokeStyle="red",this.lineWidth=3;for(var e in t)this[e]=t[e]};function winwheelAnimationLoop(){this.target.tweenSound&&this.target.tweenSound.play(),this.target.draw(!1)}function winwheelStopAnimation(){var t=this.target;t.animation.callbackFinished&&t.animation.callbackFinished(t.getIndicatedSegment())}
    </script>
    <script>
        // Script kiểm tra
        window.onload = function() {
            alert('Kiểu của Winwheel là: ' + typeof Winwheel);
        };
    </script>
</body>
</html>
